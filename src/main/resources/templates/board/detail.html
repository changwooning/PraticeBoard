<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 상세</title>
    <style>
        body { background:#f6f7fb; font-family:'Pretendard',sans-serif; }
        .container { max-width:600px; margin:40px auto; background:#fff; border-radius:18px; box-shadow:0 4px 14px #ddd; padding:34px; }
        .field { margin-bottom:16px; }
        .label { color:#444; font-weight:600; margin-bottom:6px; display:block; }
        .value { padding:7px 0 11px 0; font-size:1.08em; white-space:pre-wrap; }
        .btn-row { margin-top:20px; display:flex; gap:8px; flex-wrap:wrap; }
        .btn { background:#2864fa; color:#fff; border:none; border-radius:7px; padding:9px 17px; cursor:pointer; text-decoration:none; }
        .btn-edit { background:#2e8a44; }
        .btn-delete { background:#ff5555; }
        .btn-back { background:#aaa; }
        .comments h3 { margin:0 0 12px 0; }
    </style>
</head>
<body>
<div class="container">
    <h2 th:text="${post.title}">글 제목</h2>

    <div class="field">
        <span class="label">작성자</span>
        <span class="value" th:text="${post.username}">작성자</span>
    </div>
    <div class="field">
        <span class="label">내용</span>
        <div class="value" th:text="${post.content}">내용</div>
    </div>
    <div class="field">
        <span class="label">조회수</span>
        <span class="value" th:text="${post.viewCount}">0</span>
    </div>

    <hr style="margin:24px 0;border:none;border-top:1px solid #eee;">

    <!-- 댓글 -->
    <section class="comments">
        <h3>댓글</h3>

        <!-- 작성 -->
        <form th:action="@{|/comments/board/${post.id}|}" method="post" style="margin-bottom:14px;">
            <input type="hidden" name="boardId" th:value="${post.id}">
            <textarea name="content" rows="3" placeholder="댓글을 입력하세요" required
                      style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;"></textarea>
            <div style="text-align:right; margin-top:8px;">
                <button type="submit" class="btn">댓글 등록</button>
            </div>
        </form>

        <!-- 목록 -->
        <div th:if="${#lists.isEmpty(comments)}" style="color:#777;">아직 댓글이 없습니다.</div>
        <ul th:if="${!#lists.isEmpty(comments)}" style="list-style:none; padding:0; margin:0;">
            <li th:each="c : ${comments}" style="border-top:1px solid #f0f0f0; padding:10px 0;">
                <div style="display:flex; justify-content:space-between; align-items:baseline;">
                    <strong th:text="${c.author}">author</strong>
                    <small th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}" style="color:#888;">2025-08-10 13:00</small>
                </div>
                <div th:text="${c.content}" style="margin:6px 0 8px 0; white-space:pre-wrap;"></div>

                <!-- 본인만 수정/삭제 -->
                <div th:if="${session.username != null and session.username == c.author}">
                    <form th:action="@{|/comments/${c.id}/edit|}" method="post" style="display:inline;">
                        <input type="hidden" name="boardId" th:value="${post.id}">
                        <input type="text" name="content" th:value="${c.content}"
                               style="width:60%; padding:6px; border:1px solid #ddd; border-radius:6px;" required>
                        <button type="submit" class="btn btn-edit" style="margin-left:6px;">수정</button>
                    </form>
                    <form th:action="@{|/comments/${c.id}/delete|}" method="post" style="display:inline; margin-left:6px;">
                        <input type="hidden" name="boardId" th:value="${post.id}">
                        <button type="submit" class="btn btn-delete" onclick="return confirm('이 댓글을 삭제할까요?')">삭제</button>
                    </form>
                </div>
            </li>
        </ul>
    </section>

    <!-- 하단 버튼 -->
    <div class="btn-row">
        <a th:href="@{/board/list}" class="btn btn-back">목록</a>
        <a th:href="@{/}" class="btn btn-back">홈</a>
        <a th:href="@{/board/{id}/edit(id=${post.id})}" class="btn btn-edit" th:if="${editable}">수정</a>
        <form th:action="@{/board/{id}/delete(id=${post.id})}" method="post" th:if="${editable}" style="display:inline;">
            <button type="submit" class="btn btn-delete" onclick="return confirm('정말 삭제할까요?')">삭제</button>
        </form>
    </div>
</div>
</body>
</html>
